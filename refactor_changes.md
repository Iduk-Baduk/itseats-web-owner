# POS API 리팩토링

## 개요
POS API 관련 코드의 안정성과 유지보수성을 향상시키기 위한 리팩토링을 진행했습니다.

## 주요 변경사항

### 1. 타임스탬프 처리 개선
- UTC 기반의 일관된 타임스탬프 처리 로직 구현
- 비표준 시간대 표기(예: 'NZ') 처리 로직 추가
- 유효하지 않은 타임스탬프에 대한 방어 로직 추가
- 타임스탬프 정규화를 위한 마이그레이션 스크립트 추가

### 2. POS 상태 관리 개선
- 상태 변경 시 자동 알림 생성 기능 추가
- 상태 변경 이력 관리 로직 개선
- 상태 변경 시 메타데이터 처리 강화
- 누락된 필드에 대한 기본값 처리 추가

### 3. 자동화 기능 개선
- UTC 시간 기반의 자동 상태 변경 로직 개선
- 스케줄링 안정성 강화
- 에러 처리 및 복구 로직 추가
- 자동화 설정 관리 기능 강화

### 4. 코드 구조화
- API 메서드 모듈화
- 일관된 에러 처리 패턴 적용
- 중복 코드 제거
- 테스트 가능성 향상을 위한 구조 개선

## 테스트
- PosStatusHistory 컴포넌트 테스트 추가
- 타임스탬프 처리 유닛 테스트 추가
- 자동화 스케줄러 테스트 개선

## 영향 받는 컴포넌트
- PosStatusHistory
- PosStatusControl
- PosAutoSettings
- PosNotificationCenter

## 주의사항
1. 기존 타임스탬프는 자동으로 정규화되지만, 데이터 백업을 권장합니다
2. 자동화 설정은 UTC 시간 기준으로 동작하므로 시간대 설정에 주의가 필요합니다
3. 알림 시스템 변경으로 기존 알림 데이터가 마이그레이션됩니다

## 관련 이슈
- 타임스탬프 정규화 이슈
- POS 상태 변경 알림 개선
- 자동화 스케줄러 안정성 향상 

# 거절된 주문 숨김 처리 및 주문 아이템 관리 개선

## 개요
주문 관리 시스템의 사용성 개선을 위해 거절된 주문을 화면에서 숨기고, 주문 아이템 표시 관련 버그를 수정했습니다.

## 주요 변경사항

### 1. 거절된 주문 숨김 처리
- 주문 목록에서 거절(REJECTED) 상태의 주문을 자동으로 숨김 처리
- 기존 조리완료(READY) 상태 주문 숨김 로직과 통합
- 필터링 로직 개선으로 UI 클린업 효과

### 2. 주문 아이템 Key 중복 문제 해결
- 주문 아이템 렌더링 시 발생하는 key 중복 경고 해결
- 고유한 key 생성 로직 개선
  - 기존: `${order.orderId}-${item.name}-${item.quantity}`
  - 개선: `${order.orderId}-${item.name}-${item.quantity}-${index}`
- React 렌더링 성능 및 안정성 향상

## 구현 상세

### PosOrderList 컴포넌트 수정
```jsx
// 필터링된 주문 목록
const filteredOrders = orders.filter(order => 
  (filter === 'ALL' || order.status === filter) &&
  order.status !== 'READY' && // 조리완료된 주문은 제외
  order.status !== 'REJECTED' // 거절된 주문도 제외
);

// 주문 아이템 렌더링
{order.items.map((item, index) => (
  <div key={`${order.orderId}-${item.name}-${item.quantity}-${index}`} className={styles.item}>
    <span>{item.name}</span>
    <span>x {item.quantity}</span>
  </div>
))}
```

## 테스트 방법
1. 개발 서버 실행: `npm run dev:full`
2. 주문 시뮬레이션을 통한 테스트 주문 생성
3. 주문 거절 기능 테스트
   - 주문 거절 후 목록에서 자동으로 사라지는지 확인
   - 거절된 주문이 통계에는 반영되는지 확인
4. 동일한 메뉴/수량의 주문 아이템 처리 확인
   - 콘솔에 key 중복 경고가 없는지 확인
   - 아이템이 정상적으로 표시되는지 확인

## 영향 받는 컴포넌트
- PosOrderList
- PosOrderDetailModal (간접적 영향)

## 주의사항
1. 거절된 주문은 UI에서만 숨겨지며, API 응답에는 여전히 포함됨
2. 필터 설정이 'ALL'이어도 거절된 주문은 표시되지 않음
3. 주문 통계는 모든 상태의 주문을 포함하여 계산됨 
